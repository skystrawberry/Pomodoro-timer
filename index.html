<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Pomodoro</title>

<style>
@font-face {
  font-family: 'KyoboHandwriting2019';
  src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/KyoboHandwriting2019.woff') format('woff');
}

body {
  font-family: 'KyoboHandwriting2019', -apple-system;
  background:#f6f6f6;
  text-align:center;
  padding:8px;               /* ğŸ”½ ìƒë‹¨ ì—¬ë°± ì¶•ì†Œ */
}

/* ================= íƒ€ì´ë¨¸ ================= */
.circle {
  width:150px;               /* ğŸ”½ ê¸°ì¡´ë³´ë‹¤ ì‘ê²Œ */
  height:150px;
  margin:8px auto;
  position:relative;
}

svg { transform: rotate(-90deg); }

.bg {
  fill:none;
  stroke:#e9ecef;
  stroke-width:10;
}

.progress {
  fill:none;
  stroke-width:10;
  stroke-dasharray:440;
  stroke-dashoffset:440;
  transition:stroke-dashoffset 1s linear, stroke 0.3s;
}

.center {
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
}

.title {
  font-size:13px;
  margin-bottom:2px;
}

.time {
  font-size:26px;
}

.mode {
  font-size:12px;
}

/* ================= ë²„íŠ¼ ================= */
button {
  font-family: 'KyoboHandwriting2019';
  border:none;
  border-radius:6px;
  padding:4px 6px;
  margin:2px;
  font-size:12px;
  cursor:pointer;
}

.start { background:#ff6b6b; color:white; }
.pause { background:#4dabf7; color:white; }
.reset { background:#868e96; color:white; }

.toggle {
  margin-top:6px;
  background:#dee2e6;
}

/* ================= ì €ì¥ íŒì—… ================= */
.popup {
  display:none;
  margin-top:6px;
  padding:8px;
  background:white;
  border-radius:8px;
  font-size:12px;
}

/* ================= ì €ì¥ëœ íƒ€ì´ë¨¸ ================= */
.saved {
  margin-top:10px;
  text-align:left;
  font-size:12px;
}

.saved div {
  display:flex;
  justify-content:space-between;
  margin-bottom:4px;
}

.saved div button:first-child {
  flex:1;
}

.saved div button:last-child {
  background:#adb5bd;
  color:white;
  margin-left:4px;
}

/* ================= ëˆ„ì  ì§‘ì¤‘ ê¸°ë¡ ================= */
.stats {
  margin-top:10px;
  font-size:12px;
}

.stat-row {
  display:flex;
  align-items:center;
  margin-bottom:6px;
}

.stat-name {
  width:50px;
}

.stat-bar {
  flex:1;
  height:8px;
  background:#e9ecef;
  border-radius:6px;
  overflow:hidden;
  margin:0 6px;
}

.stat-fill {
  height:100%;
}

.stat-time {
  width:36px;
  font-size:11px;
  text-align:right;
}

.no-stats {
  text-align:center;
  color:#868e96;
}

.clear-btn {
  width:100%;
  margin-top:6px;
  background:#ff8787;
  color:white;
  font-size:11px;
}
</style>
</head>

<body>

<h3 style="margin:4px 0;">ğŸ… Pomodoro</h3>

<div class="circle">
<svg width="150" height="150">
  <circle class="bg" cx="75" cy="75" r="70"></circle>
  <circle class="progress" cx="75" cy="75" r="70"></circle>
</svg>
<div class="center">
  <div class="title" id="title">íƒ€ì´ë¨¸</div>
  <div class="time" id="time">25:00</div>
  <div class="mode" id="mode">ëŒ€ê¸° ì¤‘</div>
</div>
</div>

<button class="start" onclick="start()">Start</button>
<button class="pause" onclick="pause()">Pause</button>
<button class="reset" onclick="reset()">Reset</button>

<button class="toggle" onclick="togglePopup()">íƒ€ì´ë¨¸ ì €ì¥ â–¼</button>

<div class="popup" id="popup">
  <input id="saveTitle" placeholder="íƒ€ì´ë¨¸ ì œëª©"><br>
  ì§‘ì¤‘ <input id="saveFocus" type="number" value="25" style="width:50px"> ë¶„<br>
  íœ´ì‹ <input id="saveBreak" type="number" value="5" style="width:50px"> ë¶„<br>
  ìƒ‰ìƒ <input id="saveColor" value="#ff6b6b"><br>
  <button onclick="savePreset()">íƒ€ì´ë¨¸ ì €ì¥</button>
</div>

<div class="saved">
  <b>ì €ì¥ëœ íƒ€ì´ë¨¸</b>
  <div id="savedList"></div>
</div>

<div class="stats" id="stats"></div>
<button class="clear-btn" onclick="clearStats()">ëˆ„ì  ê¸°ë¡ ì´ˆê¸°í™”</button>

<script>
const CIRC = 2*Math.PI*70;
let mode="focus", interval=null, total=1500, elapsed=0;
let color="#ff6b6b";
let stats = JSON.parse(localStorage.getItem("focusStats")||"{}");

function update(){
  document.getElementById("time").innerText =
    String(Math.floor(elapsed/60)).padStart(2,'0')+":"+
    String(elapsed%60).padStart(2,'0');

  document.querySelector(".progress").style.stroke=color;
  document.querySelector(".progress").style.strokeDashoffset =
    CIRC*(1-elapsed/total);
}

function start(){
  if(interval) return;
  interval=setInterval(()=>{
    elapsed++;
    update();
    if(elapsed>=total){
      pause();
      stats[title.innerText]=(stats[title.innerText]||0)+Math.round(total/60);
      localStorage.setItem("focusStats",JSON.stringify(stats));
      renderStats();
      reset();
    }
  },1000);
}

function pause(){ clearInterval(interval); interval=null; }
function reset(){ pause(); elapsed=0; update(); }

function togglePopup(){
  popup.style.display = popup.style.display==="block"?"none":"block";
}

function savePreset(){
  const presets = JSON.parse(localStorage.getItem("presets")||"[]");
  presets.push({
    title: saveTitle.value,
    focus: saveFocus.value,
    break: saveBreak.value,
    color: saveColor.value
  });
  localStorage.setItem("presets",JSON.stringify(presets));
  renderPresets();
}

function renderPresets(){
  savedList.innerHTML="";
  JSON.parse(localStorage.getItem("presets")||"[]").forEach((p,i)=>{
    const div=document.createElement("div");
    const b=document.createElement("button");
    b.style.background=p.color;
    b.innerText=p.title;
    b.onclick=()=>{
      title.innerText=p.title;
      color=p.color;
      total=p.focus*60;
      reset();
    };
    const d=document.createElement("button");
    d.innerText="X";
    d.onclick=()=>{
      const arr=JSON.parse(localStorage.getItem("presets"));
      arr.splice(i,1);
      localStorage.setItem("presets",JSON.stringify(arr));
      renderPresets();
    };
    div.append(b,d);
    savedList.appendChild(div);
  });
}

function renderStats(){
  statsDiv.innerHTML="";
  const entries=Object.entries(stats);
  if(!entries.length){
    statsDiv.innerHTML='<div class="no-stats">ì§‘ì¤‘ê¸°ë¡ ì—†ìŒ</div>';
    return;
  }
  const max=Math.max(...entries.map(e=>e[1]));
  entries.forEach(([k,v])=>{
    const row=document.createElement("div");
    row.className="stat-row";
    row.innerHTML=`
      <div class="stat-name">${k}</div>
      <div class="stat-bar">
        <div class="stat-fill" style="width:${(v/max)*100}%;background:${color}"></div>
      </div>
      <div class="stat-time">${v}ë¶„</div>`;
    statsDiv.appendChild(row);
  });
}

function clearStats(){
  localStorage.removeItem("focusStats");
  stats={};
  renderStats();
}

renderPresets();
renderStats();
update();
</script>

</body>
</html>
