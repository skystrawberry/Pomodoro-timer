<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Mini Pomodoro</title>
<style>
@font-face {
  font-family: 'KyoboHandwriting2019';
  src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/KyoboHandwriting2019.woff') format('woff');
}

body {
  font-family: 'KyoboHandwriting2019', -apple-system;
  background:#f6f6f6;
  text-align:center;
  padding:15px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* ===== íƒ€ì´ë¨¸ ===== */
.circle {
  width:140px;
  height:140px;
  margin:10px auto;
  position:relative;
}

svg { transform: rotate(-90deg); }

.bg { fill:none; stroke:#e9ecef; stroke-width:10; }
.progress { 
    fill:none; 
    stroke-width:10; 
    stroke-dasharray:408.4; /* 2 * PI * 65 */
    stroke-dashoffset:408.4; 
    transition:stroke-dashoffset 0.5s linear, stroke 0.3s; 
    stroke-linecap: round;
}

.center {
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  width: 100%;
}

.title { font-size:13px; margin-bottom:2px; color: #555; }
.time { font-size:24px; font-weight: bold; }
.mode { font-size:12px; color: #888; }

/* ===== ë²„íŠ¼ ê³µí†µ ===== */
button {
  font-family: 'KyoboHandwriting2019';
  border:none;
  border-radius:6px;
  padding:5px 10px;
  margin:2px;
  font-size:13px;
  cursor:pointer;
  transition: opacity 0.2s;
}

button:hover { opacity: 0.8; }

.start { background:#ff6b6b; color:white; }
.pause { background:#4dabf7; color:white; }
.reset { background:#868e96; color:white; }

/* ===== ì„¤ì • ë° í†µê³„ ì„¹ì…˜ ===== */
.container { width: 180px; }

.store-btn, .stats-btn {
  width: 100%;
  margin-top:6px;
  background:#dee2e6;
  color: #495057;
}

.popup, .stats-popup {
  display:none;
  margin-top:6px;
  padding:10px;
  background:white;
  border-radius:8px;
  font-size:12px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  text-align: left;
}

.popup input {
  font-family: 'KyoboHandwriting2019';
  font-size:12px;
  margin:4px 0;
  padding:2px 4px;
  width:80%;
  border: 1px solid #ddd;
  border-radius: 4px;
}

/* ===== ì €ì¥ëœ íƒ€ì´ë¨¸ ëª©ë¡ ===== */
.saved { 
    margin-top:15px; 
    width: 180px;
    text-align:center; 
}
.saved b { display: block; margin-bottom: 8px; font-size: 14px; }
.saved-item { 
    display:flex; 
    justify-content:space-between; 
    margin-bottom:5px; 
}
.saved-item button:first-child { flex:1; color:white; text-align: center; }
.saved-item button:last-child { background:#ff8787; color:white; margin-left:4px; width: 30px; }

/* ===== ëˆ„ì  ê¸°ë¡ ë°” ===== */
.stat-row { display:flex; align-items:center; margin-bottom:6px; }
.stat-name { width:50px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.stat-bar { flex:1; height:10px; background:#e9ecef; border-radius:5px; overflow:hidden; margin:0 6px; }
.stat-fill { height:100%; }
.stat-time { width:35px; font-size:11px; text-align:right; }
.clear-btn { width:100%; margin-top:8px; background:#adb5bd; color:white; }
</style>
</head>
<body>

<h3 style="margin:5px 0;">ğŸ… Pomodoro</h3>

<div class="circle">
<svg width="140" height="140">
  <circle class="bg" cx="70" cy="70" r="65"></circle>
  <circle class="progress" id="prg" cx="70" cy="70" r="65"></circle>
</svg>
<div class="center">
  <div class="title" id="title">ì§‘ì¤‘í•˜ê¸°</div>
  <div class="time" id="time">25:00</div>
  <div class="mode" id="mode">ëŒ€ê¸° ì¤‘</div>
</div>
</div>

<div class="container">
    <div>
      <button class="start" onclick="start()">Start</button>
      <button class="pause" onclick="pause()">Pause</button>
      <button class="reset" onclick="reset()">Reset</button>
    </div>

    <button class="store-btn" onclick="togglePopup()">íƒ€ì´ë¨¸ ì¶”ê°€ â–¼</button>
    <div class="popup" id="popup">
      ì´ë¦„: <input id="saveTitle" placeholder="ì˜ˆ: ì½”ë”©, ë…ì„œ"><br>
      ì§‘ì¤‘: <input id="saveFocus" type="number" value="25">ë¶„<br>
      ìƒ‰ìƒ: <input id="saveColor" type="color" value="#ff6b6b" style="width:40px; height:20px; padding:0; vertical-align:middle;"><br>
      <button onclick="savePreset()" style="width:100%; margin-top:5px; background:#5c7cfa; color:white;">ëª©ë¡ì— ì¶”ê°€</button>
    </div>

    <button class="stats-btn" onclick="toggleStats()">ëˆ„ì  ê¸°ë¡ â–¼</button>
    <div class="stats-popup" id="statsPopup">
      <div id="stats"></div>
      <button class="clear-btn" onclick="clearStats()">ê¸°ë¡ ì´ˆê¸°í™”</button>
    </div>

    <div class="saved" id="savedTimers">
      <b>ë‚˜ì˜ íƒ€ì´ë¨¸</b>
      <div id="savedList"></div>
    </div>
</div>

<script>
const CIRC = 2 * Math.PI * 65; // ì•½ 408.4
let mode="focus", interval=null, total=1500, elapsed=0, color="#ff6b6b";
let focusStats = JSON.parse(localStorage.getItem("focusStats")||"{}");

// ===== UI ì—…ë°ì´íŠ¸ =====
function update(){
  const remain = total - elapsed;
  const m = Math.floor(Math.max(0, remain) / 60).toString().padStart(2,'0');
  const s = (Math.max(0, remain) % 60).toString().padStart(2,'0');
  
  document.getElementById("time").innerText = m + ":" + s;
  document.getElementById("mode").innerText = interval ? (mode==="focus"?"ì§‘ì¤‘ ì¤‘":"íœ´ì‹ ì¤‘") : "ëŒ€ê¸° ì¤‘";
  
  const prgIdx = document.getElementById("prg");
  prgIdx.style.stroke = color;
  
  // ì§„í–‰ ë°” ê³„ì‚°: ì‹œì‘ ì‹œ strokeDashoffsetì´ 0ì´ ë˜ì–´ì•¼ ê½‰ ì°¸
  const offset = total > 0 ? (elapsed / total) * CIRC : 0;
  prgIdx.style.strokeDashoffset = offset;
}

// ===== íƒ€ì´ë¨¸ ê¸°ëŠ¥ =====
function start(){
  if(interval) return;
  interval = setInterval(() => {
    elapsed++;
    update();
    if(elapsed >= total){
      pause();
      const t = document.getElementById("title").innerText;
      focusStats[t] = (focusStats[t]||0) + Math.floor(total/60);
      localStorage.setItem("focusStats", JSON.stringify(focusStats));
      renderStats();
      alert("ì‹œê°„ì´ ë‹¤ ë˜ì—ˆìŠµë‹ˆë‹¤!");
      reset();
    }
  }, 1000);
}

function pause(){ clearInterval(interval); interval=null; update(); }
function reset(){ pause(); elapsed=0; update(); }

// ===== íŒì—… í† ê¸€ =====
function togglePopup(){ 
    const p = document.getElementById("popup");
    p.style.display = p.style.display==="block"?"none":"block"; 
}
function toggleStats(){ 
    const s = document.getElementById("statsPopup");
    s.style.display = s.style.display==="block"?"none":"block"; 
}

// ===== í”„ë¦¬ì…‹ ì €ì¥ ë° ë Œë”ë§ =====
function savePreset(){
  const presets = JSON.parse(localStorage.getItem("presets")||"[]");
  presets.push({
    title: document.getElementById("saveTitle").value || "íƒ€ì´ë¨¸",
    focus: parseInt(document.getElementById("saveFocus").value) || 25,
    color: document.getElementById("saveColor").value
  });
  localStorage.setItem("presets", JSON.stringify(presets));
  renderPresets();
  togglePopup();
}

function renderPresets(){
  const savedList = document.getElementById("savedList");
  savedList.innerHTML="";
  const presets = JSON.parse(localStorage.getItem("presets")||"[]");
  
  presets.forEach((p, i) => {
    const div = document.createElement("div");
    div.className = "saved-item";
    
    const b = document.createElement("button");
    b.style.background = p.color;
    b.innerText = `${p.title} (${p.focus}ë¶„)`;
    b.onclick = () => {
      document.getElementById("title").innerText = p.title;
      color = p.color;
      total = p.focus * 60;
      reset();
    };
    
    const d = document.createElement("button");
    d.innerText = "X";
    d.onclick = () => {
      presets.splice(i, 1);
      localStorage.setItem("presets", JSON.stringify(presets));
      renderPresets();
    };
    
    div.appendChild(b);
    div.appendChild(d);
    savedList.appendChild(div);
  });
}

// ===== ëˆ„ì  ì§‘ì¤‘ ê¸°ë¡ ë Œë”ë§ =====
function renderStats(){
  const statsDiv = document.getElementById("stats");
  statsDiv.innerHTML="";
  const entries = Object.entries(focusStats);
  
  if(entries.length === 0){
    statsDiv.innerHTML = '<div style="text-align:center; color:#868e96;">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
    return;
  }
  
  const max = Math.max(...entries.map(e => e[1]));
  entries.forEach(([name, min]) => {
    const presets = JSON.parse(localStorage.getItem("presets")||"[]");
    const colorVal = presets.find(p => p.title === name)?.color || "#adb5bd";
    
    const row = document.createElement("div");
    row.className = "stat-row";
    row.innerHTML = `
      <div class="stat-name">${name}</div>
      <div class="stat-bar">
        <div class="stat-fill" style="width:${(min/max)*100}%; background:${colorVal}"></div>
      </div>
      <div class="stat-time">${min}ë¶„</div>`;
    statsDiv.appendChild(row);
  });
}

function clearStats(){
  if(confirm("ëª¨ë“  ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
    focusStats = {};
    localStorage.removeItem("focusStats");
    renderStats();
  }
}

// ì´ˆê¸°í™”
renderPresets();
renderStats();
update();
</script>
</body>
</html>
