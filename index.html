<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Mini Pomodoro</title>
<style>
@font-face {
  font-family: 'KyoboHandwriting2019';
  src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/KyoboHandwriting2019.woff') format('woff');
}

/* ëª¨ë“  ìš”ì†Œì— í°íŠ¸ ì ìš© */
* { font-family: 'KyoboHandwriting2019', -apple-system !important; }

body {
  background:#f6f6f6;
  text-align:center;
  padding:20px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* ===== íƒ€ì´ë¨¸ ì™¸í˜• ===== */
.circle {
  width:140px;
  height:140px;
  margin:10px auto;
  position:relative;
}

svg { transform: rotate(-90deg); }

.bg { fill:none; stroke:#e9ecef; stroke-width:10; }
.progress { 
  fill:none; 
  stroke-width:10; 
  stroke-dasharray:408.4; 
  stroke-dashoffset:408.4; 
  transition:stroke-dashoffset 0.5s linear, stroke 0.3s; 
  stroke-linecap: round;
}

.center {
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  width: 100%;
}

.title { font-size:13px; margin-bottom:2px; color: #555; }
.time { font-size:24px; font-weight: bold; }
.mode { font-size:12px; color: #888; }

/* ===== ë²„íŠ¼ ë ˆì´ì•„ì›ƒ ===== */
.container { width: 220px; }

button {
  border:none;
  border-radius:8px;
  padding:6px 10px;
  margin:3px;
  font-size:14px;
  cursor:pointer;
}

.start { background:#ff6b6b; color:white; }
.pause { background:#4dabf7; color:white; }
.reset { background:#868e96; color:white; }

.sub-btns { display: flex; justify-content: center; gap: 5px; margin-top: 5px; }
.store-btn, .stats-btn {
  background:#dee2e6;
  color: #495057;
  font-size: 12px;
  flex: 1;
}

/* ===== ì„¤ì • íŒì—… (íœ´ì‹ ì…ë ¥ ì¶”ê°€) ===== */
.popup, .stats-popup {
  display:none;
  margin-top:10px;
  padding:12px;
  background:white;
  border-radius:10px;
  font-size:13px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.05);
  text-align: left;
}

.popup input {
  width: 70px;
  margin: 5px 0;
  padding: 4px;
  border: 1px solid #ddd;
  border-radius: 4px;
}

#saveTitle { width: 85%; }

/* ===== ì €ì¥ëœ íƒ€ì´ë¨¸ ë¦¬ìŠ¤íŠ¸ ===== */
.saved { 
  margin-top: 20px; 
  width: 100%;
  text-align: left;
}
.saved b { display: block; margin-bottom: 8px; font-size: 14px; border-bottom: 1px solid #ddd; padding-bottom: 4px; }
.saved-item { 
  display: flex; 
  align-items: center; 
  margin-bottom: 6px; 
}
.saved-item button:first-child { 
  flex: 1; 
  color: white; 
  text-align: center; 
  font-size: 13px;
  padding: 8px;
}
.saved-item button:last-child { 
  background: #adb5bd; 
  color: white; 
  width: 30px; 
  margin-left: 5px; 
}

/* ===== ê¸°ë¡ ë°” ===== */
.stat-row { display:flex; align-items:center; margin-bottom:6px; }
.stat-name { width:50px; white-space: nowrap; overflow: hidden; }
.stat-bar { flex:1; height:10px; background:#e9ecef; border-radius:5px; margin:0 8px; position:relative; }
.stat-fill { height:100%; border-radius:5px; }
.stat-time { width:35px; font-size:11px; text-align:right; }
</style>
</head>
<body>

<h3 style="margin:10px 0;">ğŸ… Pomodoro</h3>

<div class="circle">
<svg width="140" height="140">
  <circle class="bg" cx="70" cy="70" r="65"></circle>
  <circle class="progress" id="prg" cx="70" cy="70" r="65"></circle>
</svg>
<div class="center">
  <div class="title" id="title">íƒ€ì´ë¨¸</div>
  <div class="time" id="time">00:00</div>
  <div class="mode" id="mode">ëŒ€ê¸° ì¤‘</div>
</div>
</div>

<div class="container">
    <div>
      <button class="start" onclick="start()">Start</button>
      <button class="pause" onclick="pause()">Pause</button>
      <button class="reset" onclick="reset()">Reset</button>
    </div>

    <div class="sub-btns">
      <button class="store-btn" onclick="togglePopup()">íƒ€ì´ë¨¸ ì €ì¥ â–¼</button>
      <button class="stats-btn" onclick="toggleStats()">ëˆ„ì  ê¸°ë¡ â–¼</button>
    </div>

    <div class="popup" id="popup">
      <input id="saveTitle" placeholder="íƒ€ì´ë¨¸ ì œëª©"><br>
      ì§‘ì¤‘ <input id="saveFocus" type="number" value="25">ë¶„ / 
      íœ´ì‹ <input id="saveBreak" type="number" value="5">ë¶„<br>
      ìƒ‰ìƒ <input id="saveColor" type="color" value="#ff6b6b" style="height:30px; padding:0; border:none; width:100%;"><br>
      <button onclick="savePreset()" style="width:100%; background:#4dabf7; color:white; margin-top:5px;">ì €ì¥í•˜ê¸°</button>
    </div>

    <div class="stats-popup" id="statsPopup">
      <div id="stats"></div>
      <button onclick="clearStats()" style="width:100%; background:#868e96; color:white; font-size:11px; margin-top:10px;">ê¸°ë¡ ì´ˆê¸°í™”</button>
    </div>

    <div class="saved">
      <b>ì €ì¥ëœ íƒ€ì´ë¨¸</b>
      <div id="savedList"></div>
    </div>
</div>

<script>
const CIRC = 2 * Math.PI * 65; 
let mode="focus", interval=null, total=0, elapsed=0, color="#ff6b6b";
let currentFocus = 0, currentBreak = 0; // í˜„ì¬ ì„ íƒëœ ì„¤ì •ê°’ ì €ì¥
let focusStats = JSON.parse(localStorage.getItem("focusStats")||"{}");

function update(){
  const remain = total - elapsed;
  const m = Math.floor(Math.max(0, remain) / 60).toString().padStart(2,'0');
  const s = (Math.max(0, remain) % 60).toString().padStart(2,'0');
  
  document.getElementById("time").innerText = m + ":" + s;
  
  const prg = document.getElementById("prg");
  prg.style.stroke = color;
  
  if (total === 0 || elapsed === 0) {
    prg.style.strokeDashoffset = CIRC;
  } else {
    const offset = CIRC * (1 - elapsed / total);
    prg.style.strokeDashoffset = offset;
  }
}

// ===== ìë™ ì „í™˜ ë¡œì§ì´ í¬í•¨ëœ íƒ€ì´ë¨¸ ê¸°ëŠ¥ =====
function start(){
  if(interval || total === 0) return;
  document.getElementById("mode").innerText = mode === "focus" ? "ì§‘ì¤‘ ì¤‘" : "íœ´ì‹ ì¤‘";
  
  interval = setInterval(() => {
    elapsed++;
    update();
    if(elapsed >= total){
      pause();
      if(mode === "focus"){
        // ì§‘ì¤‘ ì™„ë£Œ ì‹œ
        const t = document.getElementById("title").innerText;
        focusStats[t] = (focusStats[t]||0) + Math.floor(total/60);
        localStorage.setItem("focusStats", JSON.stringify(focusStats));
        renderStats();
        alert("ì§‘ì¤‘ ì™„ë£Œ! íœ´ì‹ì„ ì‹œì‘í•©ë‹ˆë‹¤.");
        
        // íœ´ì‹ ëª¨ë“œë¡œ ì „í™˜ ë° ìë™ ì‹œì‘
        mode = "break";
        total = currentBreak * 60;
        elapsed = 0;
        update();
        start(); 
      } else {
        // íœ´ì‹ ì™„ë£Œ ì‹œ
        alert("íœ´ì‹ ì™„ë£Œ! ë‹¤ì‹œ ì§‘ì¤‘ì„ ì‹œì‘í•©ë‹ˆë‹¤.");
        mode = "focus";
        total = currentFocus * 60;
        elapsed = 0;
        update();
        start();
      }
    }
  }, 1000);
}

function pause(){ clearInterval(interval); interval=null; document.getElementById("mode").innerText = "ì¼ì‹œì •ì§€"; }
function reset(){ pause(); elapsed=0; mode="focus"; document.getElementById("mode").innerText = "ëŒ€ê¸° ì¤‘"; update(); }

function togglePopup(){ popup.style.display = popup.style.display==="block"?"none":"block"; }
function toggleStats(){ statsPopup.style.display = statsPopup.style.display==="block"?"none":"block"; }

function savePreset(){
  const presets = JSON.parse(localStorage.getItem("presets")||"[]");
  presets.push({
    title: document.getElementById("saveTitle").value || "íƒ€ì´ë¨¸",
    focus: document.getElementById("saveFocus").value,
    break: document.getElementById("saveBreak").value,
    color: document.getElementById("saveColor").value
  });
  localStorage.setItem("presets", JSON.stringify(presets));
  renderPresets();
  togglePopup();
}

function renderPresets(){
  const savedList = document.getElementById("savedList");
  savedList.innerHTML="";
  const presets = JSON.parse(localStorage.getItem("presets")||"[]");
  presets.forEach((p, i) => {
    const div = document.createElement("div");
    div.className = "saved-item";
    const b = document.createElement("button");
    b.style.background = p.color;
    // ë¦¬ìŠ¤íŠ¸ì— ì§‘ì¤‘/íœ´ì‹ ì‹œê°„ ëª¨ë‘ í‘œì‹œ
    b.innerText = `${p.title} (ì§‘ì¤‘:${p.focus}ë¶„ / íœ´ì‹:${p.break}ë¶„)`;
    b.onclick = () => {
      document.getElementById("title").innerText = p.title;
      color = p.color;
      currentFocus = p.focus;
      currentBreak = p.break;
      total = currentFocus * 60;
      reset();
    };
    const d = document.createElement("button");
    d.innerText = "X";
    d.onclick = () => {
      presets.splice(i, 1);
      localStorage.setItem("presets", JSON.stringify(presets));
      renderPresets();
    };
    div.append(b, d);
    savedList.append(div);
  });
}

function renderStats(){
  stats.innerHTML="";
  const entries = Object.entries(focusStats);
  if(!entries.length) { stats.innerHTML = "<center>ê¸°ë¡ ì—†ìŒ</center>"; return; }
  const max = Math.max(...entries.map(e => e[1]));
  entries.forEach(([name, min]) => {
    const presets = JSON.parse(localStorage.getItem("presets")||"[]");
    const pColor = presets.find(p=>p.title===name)?.color || "#adb5bd";
    stats.innerHTML += `
      <div class="stat-row">
        <div class="stat-name">${name}</div>
        <div class="stat-bar"><div class="stat-fill" style="width:${(min/max)*100}%; background:${pColor}"></div></div>
        <div class="stat-time">${min}ë¶„</div>
      </div>`;
  });
}

function clearStats(){ if(confirm("ê¸°ë¡ì„ ì§€ìš¸ê¹Œìš”?")) { focusStats={}; localStorage.removeItem("focusStats"); renderStats(); } }

renderPresets();
renderStats();
update();
</script>
</body>
</html>
