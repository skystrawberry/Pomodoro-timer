<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Mini Pomodoro</title>
<style>
@font-face {
  font-family: 'KyoboHandwriting2019';
  src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/KyoboHandwriting2019.woff') format('woff');
}

body {
  font-family: 'KyoboHandwriting2019', -apple-system;
  background:#f6f6f6;
  text-align:center;
  padding:6px;
}

/* ===== íƒ€ì´ë¨¸ ===== */
.circle {
  width:140px;
  height:140px;
  margin:6px auto;
  position:relative;
}

svg { transform: rotate(-90deg); }

.bg { fill:none; stroke:#e9ecef; stroke-width:10; }
.progress { fill:none; stroke-width:10; stroke-dasharray:440; stroke-dashoffset:440; transition:stroke-dashoffset 1s linear, stroke 0.3s; }

.center {
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
}

.title { font-size:13px; margin-bottom:2px; }
.time { font-size:24px; }
.mode { font-size:12px; }

/* ===== ë²„íŠ¼ ===== */
button {
  font-family: 'KyoboHandwriting2019';
  border:none;
  border-radius:6px;
  padding:3px 5px;
  margin:2px;
  font-size:12px;
  cursor:pointer;
}

.start { background:#ff6b6b; color:white; }
.pause { background:#4dabf7; color:white; }
.reset { background:#868e96; color:white; }
.toggle { margin-top:4px; background:#dee2e6; }

/* ===== ì €ì¥ íŒì—… ===== */
.popup {
  display:none;
  margin-top:4px;
  padding:6px;
  background:white;
  border-radius:8px;
  font-size:12px;
}

.popup input {
  font-family: 'KyoboHandwriting2019';
  font-size:12px;
  margin:2px 0;
  padding:2px 4px;
  width:90%;
}

/* ===== ì €ì¥ëœ íƒ€ì´ë¨¸ ===== */
.saved { margin-top:8px; text-align:left; font-size:12px; }
.saved div { display:flex; justify-content:space-between; margin-bottom:4px; }
.saved div button:first-child { flex:1; }
.saved div button:last-child { background:#adb5bd; color:white; margin-left:4px; }

/* ===== ëˆ„ì  ì§‘ì¤‘ ê¸°ë¡ ===== */
.stats { margin-top:6px; font-size:12px; }
.stat-row { display:flex; align-items:center; margin-bottom:4px; }
.stat-name { width:50px; }
.stat-bar { flex:1; height:8px; background:#e9ecef; border-radius:6px; overflow:hidden; margin:0 4px; }
.stat-fill { height:100%; }
.stat-time { width:30px; font-size:11px; text-align:right; }
.no-stats { text-align:center; color:#868e96; }

.clear-btn { width:100%; margin-top:4px; background:#ff8787; color:white; font-size:11px; padding:3px 0; border-radius:6px; }
</style>
</head>
<body>

<h3 style="margin:2px 0;">ğŸ… Pomodoro</h3>

<div class="circle">
<svg width="140" height="140">
  <circle class="bg" cx="70" cy="70" r="65"></circle>
  <circle class="progress" cx="70" cy="70" r="65"></circle>
</svg>
<div class="center">
  <div class="title" id="title">íƒ€ì´ë¨¸</div>
  <div class="time" id="time">25:00</div>
  <div class="mode" id="mode">ëŒ€ê¸° ì¤‘</div>
</div>
</div>

<!-- Start / Pause / Reset ë²„íŠ¼ -->
<div>
  <button class="start" onclick="start()">Start</button>
  <button class="pause" onclick="pause()">Pause</button>
  <button class="reset" onclick="reset()">Reset</button>
</div>

<!-- íƒ€ì´ë¨¸ ì €ì¥ / ëˆ„ì  ê¸°ë¡ ë²„íŠ¼ -->
<button class="toggle" onclick="togglePopup()">íƒ€ì´ë¨¸ ì €ì¥ / ëˆ„ì  ê¸°ë¡ â–¼</button>

<div class="popup" id="popup">
  <input id="saveTitle" placeholder="íƒ€ì´ë¨¸ ì œëª©"><br>
  ì§‘ì¤‘ <input id="saveFocus" type="number" min="1" max="60" value="25">ë¶„<br>
  íœ´ì‹ <input id="saveBreak" type="number" min="1" max="60" value="5">ë¶„<br>
  ìƒ‰ìƒ <input id="saveColor" value="#ff6b6b"><br>
  <button onclick="savePreset()">íƒ€ì´ë¨¸ ì €ì¥</button>
  <button class="clear-btn" onclick="clearStats()">ëˆ„ì  ê¸°ë¡ ì´ˆê¸°í™”</button>
</div>

<div class="saved">
  <b>ì €ì¥ëœ íƒ€ì´ë¨¸</b>
  <div id="savedList"></div>
</div>

<div class="stats" id="stats"></div>

<script>
const CIRC = 2*Math.PI*65;
let mode="focus", interval=null, total=1500, elapsed=0, color="#ff6b6b";
let focusStats = JSON.parse(localStorage.getItem("focusStats")||"{}");

// ===== UI ì—…ë°ì´íŠ¸ =====
function update(){
  const m=Math.floor(elapsed/60).toString().padStart(2,'0');
  const s=(elapsed%60).toString().padStart(2,'0');
  document.getElementById("time").innerText = m+":"+s;
  document.getElementById("mode").innerText = mode==="focus"?"ì§‘ì¤‘ ì¤‘":"íœ´ì‹ ì¤‘";
  document.querySelector(".progress").style.stroke=color;
  document.querySelector(".progress").style.strokeDashoffset = CIRC*(1-elapsed/total);
}

// ===== íƒ€ì´ë¨¸ ê¸°ëŠ¥ =====
function start(){
  if(interval) return;
  interval=setInterval(()=>{
    elapsed++;
    update();
    if(elapsed>=total){
      pause();
      const t = document.getElementById("title").innerText;
      focusStats[t] = (focusStats[t]||0) + Math.round(total/60);
      localStorage.setItem("focusStats",JSON.stringify(focusStats));
      renderStats();
      reset();
    }
  },1000);
}
function pause(){ clearInterval(interval); interval=null; }
function reset(){ pause(); elapsed=0; update(); }

// ===== íŒì—… í† ê¸€ =====
function togglePopup(){
  popup.style.display = popup.style.display==="block"?"none":"block";
}

// ===== ì €ì¥ëœ íƒ€ì´ë¨¸ =====
function savePreset(){
  const presets = JSON.parse(localStorage.getItem("presets")||"[]");
  presets.push({
    title: saveTitle.value,
    focus: saveFocus.value,
    break: saveBreak.value,
    color: saveColor.value
  });
  localStorage.setItem("presets",JSON.stringify(presets));
  renderPresets();
}

function renderPresets(){
  savedList.innerHTML="";
  JSON.parse(localStorage.getItem("presets")||"[]").forEach((p,i)=>{
    const div=document.createElement("div");
    const b=document.createElement("button");
    b.style.background=p.color;
    b.innerText=p.title;
    b.onclick=()=>{
      title.innerText=p.title;
      color=p.color;
      total=p.focus*60;
      reset();
    };
    const d=document.createElement("button");
    d.innerText="X";
    d.onclick=()=>{
      const arr=JSON.parse(localStorage.getItem("presets"));
      arr.splice(i,1);
      localStorage.setItem("presets",JSON.stringify(arr));
      renderPresets();
    };
    div.appendChild(b);
    div.appendChild(d);
    savedList.appendChild(div);
  });
}

// ===== ëˆ„ì  ì§‘ì¤‘ ê¸°ë¡ =====
function renderStats(){
  stats.innerHTML="";
  const entries=Object.entries(focusStats);
  if(entries.length===0){
    stats.innerHTML='<div class="no-stats">ì§‘ì¤‘ê¸°ë¡ ì—†ìŒ</div>';
    return;
  }
  const max=Math.max(...entries.map(e=>e[1]));
  entries.forEach(([name, min])=>{
    const colorVal = JSON.parse(localStorage.getItem("presets")||"[]").find(p=>p.title===name)?.color || "#adb5bd";
    const row=document.createElement("div");
    row.className="stat-row";
    row.innerHTML=`
      <div class="stat-name">${name}</div>
      <div class="stat-bar">
        <div class="stat-fill" style="width:${(min/max)*100}%;background:${colorVal}"></div>
      </div>
      <div class="stat-time">${min}ë¶„</div>`;
    stats.appendChild(row);
  });
}

// ===== ëˆ„ì  ê¸°ë¡ ì´ˆê¸°í™” =====
function clearStats(){
  focusStats={};
  localStorage.removeItem("focusStats");
  renderStats();
}

document.getElementById("saveTitle").oninput=()=>document.getElementById("title").innerText=document.getElementById("saveTitle").value;

renderPresets();
renderStats();
update();
</script>
</body>
</html>
